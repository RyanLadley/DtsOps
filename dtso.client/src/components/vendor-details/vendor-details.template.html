<div class="background vendor-details-background "></div>
<ng-container *ngIf="vendor">
    <h1 class="title multi-title">{{vendor.name}}</h1>
    <h2 class="sub-title">Vendor Details</h2>

    <div class="account-details-column vendor-details-section section">
        <div class="vendor-details">
            <h2 class="section-title">Summary</h2>
            <div class="vendor-details-header-bar header-bar">
                <h3>Basics</h3>

                <ng-container *ngIf="permissions=='Admin'">
                    <i class="fa fa-pencil-square-o clickable edit-button" *ngIf="!editBasics" (click)="toggleEditBasics(true)"></i>

                    <button class="cancel-button clickable" *ngIf="editBasics" (click)="toggleEditBasics(false)">Cancel</button>
                    <button class="submit-button clickable" *ngIf="editBasics" (click)="submitAdjustment()">Submit Changes</button>
                </ng-container>
            </div>
            <p class="error">{{errorMessage}}</p>
            <table class="table vendor-basics-table">
                <tr>
                    <td class="default-size bold">Name</td>
                    <td class="number"  *ngIf="!editBasics">{{vendor.name}}</td>
                    <td class="number"  *ngIf="editBasics"><input type="text" [(ngModel)]="vendor.name"/></td>
                </tr>
                <tr>
                    <td class="default-size bold">Contract Number</td>
                    <td class="number"  *ngIf="!editBasics">{{vendor.contractNumber}}</td>
                    <td class="number" *ngIf="editBasics"><input type="text" [(ngModel)]="vendor.contractNumber" /></td>
                </tr>
                <tr>
                    <td class="default-size bold">Contract Start</td>
                    <td class="number" *ngIf="!editBasics">{{vendor.contractStart | date:'shortDate'}}</td>
                    <td class="number" *ngIf="editBasics"><input type="date"  [value]="vendor.contractStart | date:'yyyy-MM-dd'" (input)="vendor.contractStart=parseDate($event.target.value)" required></td>
                </tr>
                <tr>
                    <td class="default-size bold">Contract End</td>
                    <td class="number"  *ngIf="!editBasics">{{vendor.contractEnd | date:'shortDate'}}</td>
                    <td class="number" *ngIf="editBasics"><input type="date" [value]="vendor.contractEnd | date:'yyyy-MM-dd'" (input)="vendor.contractEnd=parseDate($event.target.value)" required></td>
                </tr>
                <tr>
                    <td class="default-size bold">Status</td>
                    <td class="number">
                        {{vendor.status}}
                        <span class="toggle">
                            <label class="switch" *ngIf="editBasics">
                                <input type="checkbox" [(ngModel)] ="vendor.active" (change)="alterStatus(vendor.active)">
                                <span class="slider round"></span>
                            </label>
                        </span>
                    </td>
                </tr>
            </table>
            <div class="vendor-details-header-bar header-bar">
                <h3>Contact</h3>
            </div>
            <table class="table vendor-basics-table">
                <tr>
                    <td class="default-size bold">Point of Contact</td>
                    <td class="number"  *ngIf="!editBasics">{{vendor.pointOfContact}}</td>
                    <td class="number" *ngIf="editBasics"><input type="text" [(ngModel)]="vendor.pointOfContact" /></td>
                </tr>
                <tr>
                    <td class="default-size bold">Phone Number</td>
                    <td class="number"  *ngIf="!editBasics">{{vendor.phoneNumber}}</td>
                    <td class="number" *ngIf="editBasics"><input type="text" [(ngModel)]="vendor.phoneNumber" /></td>
                </tr>
                <tr>
                    <td class="default-size bold">Website</td>
                    <td class="number"  *ngIf="!editBasics">{{vendor.website}}</td>
                    <td class="number" *ngIf="editBasics"><input type="text" [(ngModel)]="vendor.website" /></td>
                </tr>
                <tr>
                    <td class="default-size bold">Email</td>
                    <td class="number" *ngIf="!editBasics">{{vendor.email}}</td>
                    <td class="number" *ngIf="editBasics"><input type="text" [(ngModel)]="vendor.email" /></td>
                </tr>
            </table>
        </div>
    </div>

    <div class="vendor-details-table-container section">
        <h2 class="section-title">Vendor Breakdown</h2>
        <div class="filter-container vendor-details-header-bar header-bar">
            <div class="filter" [ngClass]="{'selected-filter' : displayedBreakdown == 'Invoice'}" (click)="setDisplayedBreakdown('Invoice')">
                <p>Invoices</p>
            </div>
            <div class="filter" [ngClass]="{'selected-filter': displayedBreakdown == 'Ticket'}" (click)="setDisplayedBreakdown('Ticket')">
                <p>Tickets</p>
            </div>
            <div class="filter" [ngClass]="{'selected-filter': displayedBreakdown == 'Material'}" (click)="setDisplayedBreakdown('Material')">
                <p>Materials</p>
            </div>
        </div>


        <table *ngIf="displayedBreakdown == 'Invoice'" class="vendor-details-table table">
            <tr class="table-head">
                <th class="default-size sortable" (click)="sortInvoicesBy('accountNumber')">Account<i class="fa" [ngClass]="getInvoiceSortIcon('accountNumber')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortInvoicesBy('invoiceNumber')">Invoice<i class="fa" [ngClass]="getInvoiceSortIcon('invoiceNumber')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortInvoicesBy('vendor')">Vendor<i class="fa" [ngClass]="getInvoiceSortIcon('vendor')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortInvoicesBy('invoiceType')">Type<i class="fa" [ngClass]="getInvoiceSortIcon('invoiceType')" aria-hidden="true"></i></th>
                <th class="description sortable" (click)="sortInvoicesBy('description')">Descrpition<i class="fa" [ngClass]="getInvoiceSortIcon('description')" aria-hidden="true"></i></th>
                <th class="number sortable" (click)="sortInvoicesBy('invoiceDate')">Invoice Date<i class="fa" [ngClass]="getInvoiceSortIcon('invoiceDate')" aria-hidden="true"></i></th>
                <th class="number sortable" (click)="sortInvoicesBy('datePaid')">Date Paid<i class="fa" [ngClass]="getInvoiceSortIcon('datePaid')" aria-hidden="true"></i></th>
                <th class="number sortable" (click)="sortInvoicesBy('expense')">Expense<i class="fa" [ngClass]="getInvoiceSortIcon('expense')" aria-hidden="true"></i></th>
            </tr>
            <ng-container *ngFor="let invoice of vendor.invoices">
                <tr [routerLink]="['/invoice', invoice.invoiceId]" class="clickable">
                    <td class="default-size">{{invoice.accountNumber}}</td>
                    <td class="default-size">{{invoice.invoiceNumber}}</td>
                    <td class="default-size">{{invoice.vendor.name}}</td>
                    <td class="default-size">{{invoice.invoiceType.name}}</td>
                    <td class="description">{{invoice.description}}</td>
                    <td class="number default-size">{{invoice.invoiceDate | date:'shortDate'}}</td>
                    <td class="number default-size">{{invoice.datePaid  | date:'shortDate'}}</td>
                    <td class="number">{{invoice.expense  | currency:'USD':true:'1.2-2'}}</td>
                </tr>
            </ng-container>
        </table>

        <table *ngIf="displayedBreakdown == 'Ticket'" class="vendor-details-table table">
            <tr class="table-head">
                <th class="default-size sortable" (click)="sortTicketsBy('account')">Account<i class="fa" [ngClass]="getTicketSortIcon('account')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortTicketsBy('ticketNumber')">Ticket Number<i class="fa" [ngClass]="getTicketSortIcon('ticketNumber')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortTicketsBy('vendor')">Vendor<i class="fa" [ngClass]="getTicketSortIcon('vendor')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortTicketsBy('invoice')">Invoice<i class="fa" [ngClass]="getTicketSortIcon('invoice')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortTicketsBy('material')">Material<i class="fa" [ngClass]="getTicketSortIcon('material')" aria-hidden="true"></i></th>
                <th class="default-size sortable" (click)="sortTicketsBy('quantity')">Quantity<i class="fa" [ngClass]="getTicketSortIcon('quantity')" aria-hidden="true"></i></th>
                <th class="number sortable" (click)="sortTicketsBy('cost')">Cost<i class="fa" [ngClass]="getTicketSortIcon('cost')" aria-hidden="true"></i></th>
            </tr>
            <ng-container *ngFor="let ticket of vendor.tickets">
                <tr [routerLink]="['/ticket', ticket.ticketId]" class="clickable">
                    <td class="default-size">{{ticket.account | accountName}}</td>
                    <td class="default-size">{{ticket.ticketNumber}}</td>
                    <td class="default-size">{{ticket.vendor.name}}</td>
                    <td class="default-size"><span *ngIf="ticket.invoice">{{ticket.invoice.invoiceNumber}}</span><span *ngIf="!ticket.invoice">Pending</span></td>
                    <td class="default-size">{{ticket.material.name}}</td>
                    <td class="default-size">{{ticket.quantity}} {{ticket.material.unit}}</td>
                    <td class="number">{{ticket.cost | currency:'USD':true:'1.2-2'}}</td>
                </tr>
            </ng-container>
        </table>

        <table *ngIf="displayedBreakdown == 'Material'" class="vendor-details-table table">
            <tr class="table-head">
                <th class="default-size">Material Name</th>
                <th class="default-size">Unit</th>
                <th class="number">Cost</th>
            </tr>
            <ng-container *ngFor="let material of vendor.materials">
                <tr class="clickable" (click)="gotoMaterial(material.materialId)">
                    <td class="default-size">{{material.name}}</td>
                    <td class="default-size">{{material.unit}}</td>
                    <td class="number">{{material.cost | currency:'USD':true:'1.2-2'}}</td>
                </tr>
            </ng-container>
        </table>
    </div>
</ng-container>